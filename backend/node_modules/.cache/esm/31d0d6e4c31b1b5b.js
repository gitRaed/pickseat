"use strict";;let sql;_c31‍.x([["getPointImportant",()=>getPointImportant],["registerMessage",()=>registerMessage],["registerPointImportant",()=>registerPointImportant],["updatePointImportant",()=>updatePointImportant],["deletePointImportant",()=>deletePointImportant],["getTrajet",()=>getTrajet],["rechercherTrajet1",()=>rechercherTrajet1],["rechercherEscale",()=>rechercherEscale],["enregistrerTrajet",()=>enregistrerTrajet],["updateTrajet",()=>updateTrajet],["deleteTrajet",()=>deleteTrajet]]);_c31‍.w("mssql",[["default",["sql"],function(v){sql=v}]]);


var config = {
    user: 'sa',
    password: 'raed',
    server: 'localhost',
    database: 'pickseat',
    "options": {
        "encrypt": true,
        "enableArithAbort": true
    },
};


       async function getPointImportant(email) {

    try {
        
        const pool = await new sql.ConnectionPool(config).connect();
        const result = await pool.request()
                        .input('email', email)
                        .query('SELECT * FROM pointImportant WHERE email_user=@email');
        return result.recordset;
    } catch (error) {
        _c31‍.g.console.log('Requete_map, get point important error : ' + error);
        return error;
    }
}


       async function registerMessage(email, message) {

    try {
        const pool = await new sql.ConnectionPool(config).connect();
        await pool.request()
            .input('email', email)
            .input('message', message)
            .query('INSERT INTO contactUs VALUES (@email, @message)');
            return 'Message enregistrée!';
    } catch (error) {
        _c31‍.g.console.log('Register Message, erreur : ' + error);
        return 'Register message erreur,' + error;
    }
}

       async function registerPointImportant(email, message, latitude, longitude) {

    try {
        const pool = await new sql.ConnectionPool(config).connect();
        await pool.request()
            .input('email', email)
            .input('message', message)
            .input('latitude', latitude)
            .input('longitude', longitude)
            .query('INSERT INTO pointImportant VALUES (@email, @message, @latitude, @longitude)');
            return 'Point important enregistré!';
    } catch (error) {
        _c31‍.g.console.log('Register point important error : ' + error);
        return 'Register point important error : ' + error;
    }
}

       async function updatePointImportant(id, message) {

    try {
        const pool = await new sql.ConnectionPool(config).connect();
        await pool.request()
                .input('id', id)
                .input('message', message)
                .query('UPDATE pointImportant SET message=@message WHERE id_points=@id');
        return 'Point modifié!';
    } catch (error) {
        _c31‍.g.console.log("update point important error : " + error);
        return error;
    }
}

       async function deletePointImportant(id) {

    try {
        const pool = await new sql.ConnectionPool(config).connect();
        await pool.request()
            .input('id', id)
            .query('DELETE pointImportant WHERE id_points=@id');
        return 'Point supprimé!';
    } catch (error) {
        _c31‍.g.console.log('Delete point important error : ' + error);
        return error;
    }
}

       async function getTrajet(email) {

    try {
        
        const pool = await new sql.ConnectionPool(config).connect();
        const result = await pool.request()
                        .input('email', email)
                        .query('SELECT * FROM trajet WHERE email_chauffeur=@email');
        return result.recordset;
    } catch (error) {
        _c31‍.g.console.log('Requête getTrajet error : ' + error);
        return error;
    }
}

       async function rechercherTrajet1(adresse_depart, adresse_arrive, date_trajet) {

    try {
        
        const pool = await new sql.ConnectionPool(config).connect();
        const result = await pool.request()
                        .input('adresse_depart', adresse_depart)
                        .input('adresse_arrive', adresse_arrive)
                        .query('SELECT * FROM trajet WHERE adresse_depart=@adresse_depart and adresse_arrive=@adresse_arrive ORDER BY date_trajet');
        return result.recordset;

    } catch (error) {
        _c31‍.g.console.log('Rerchercher trajet error : ' + error);
        return error;
    }
}

       async function rechercherEscale() {

    try {
        const options = 'oui';
        const pool = await new sql.ConnectionPool(config).connect();
        const result = await pool.request()
                                    .input('options', options)
                                    .query('SELECT * FROM trajet WHERE options=@options');
        return result.recordset;
    } catch (error) {
        _c31‍.g.console.log('Requête rechercher escale error : ' + error);
        return error;
    }
}
       async function enregistrerTrajet(nom_chauffeur, prenom_chauffeur, email, numero, adresse_depart, adresse_arrive, heure_trajet, date_trajet, options, escale) {
    
    try {
        
        const pool = await new sql.ConnectionPool(config).connect();
        await pool.request()
                    .input('nom', nom_chauffeur)
                    .input('prenom', prenom_chauffeur)
                    .input('email', email)
                    .input('numero', numero)
                    .input('adresse_depart', adresse_depart)
                    .input('adresse_arrive', adresse_arrive)
                    .input('heure_trajet', heure_trajet)
                    .input('date_trajet', date_trajet)
                    .input('options', options)
                    .input('escale', escale)
                .query('INSERT INTO trajet VALUES (@nom, @prenom, @email, @numero, @adresse_depart, @adresse_arrive, @heure_trajet, @date_trajet, @options, @escale)');
        return 'Trajet enregistré !';
    } catch (error) {
        _c31‍.g.console.log('Requête enregistrer trajet error : ' + error);
        return error;
    }
}

       async function updateTrajet(id, adresse_depart, adresse_arrive, heure_trajet, date_trajet, options, escale) {
    
    try {
        
        const pool = await new sql.ConnectionPool(config).connect();
        await pool.request()
                    .input('id', id)
                    .input('adresse_depart', adresse_depart)
                    .input('adresse_arrive', adresse_arrive)
                    .input('heure_trajet', heure_trajet)
                    .input('date_trajet', date_trajet)
                    .input('options', options)
                    .input('escale', escale)
                .query('UPDATE trajet SET adresse_depart = @adresse_depart, adresse_arrive = @adresse_arrive, heure_trajet = @heure_trajet, date_trajet = @date_trajet, options = @options, escale = @escale WHERE id_trajet = @id');
        return 'Trajet modifié !';
    } catch (error) {
        _c31‍.g.console.log('Requête update trajet error : ' + error);
        return error;
    }
}

       async function deleteTrajet(id) {
    
    try {
        
        const pool = await new sql.ConnectionPool(config).connect();
        await pool.request()
                    .input('id', id)
                .query('DELETE trajet WHERE id_trajet = @id');
        return 'Trajet supprimé !';
    } catch (error) {
        _c31‍.g.console.log('Requête delete trajet error : ' + error);
        return error;
    }
}