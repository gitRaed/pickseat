<div id="map" 
    leaflet
    (leafletMapReady)="onMapReady($event)"
    [leafletOptions] = "mapOptions()"
    [(leafletCenter)] = "mapOptions().center"
    [(leafletZoom)] = "mapOptions().zoom"
    [leafletLayersControl] = "mapLayersControl()"
    (leafletClick) = "!getPointImportant() || recupCoordonnees($event)"
    (leafletClick) = "!getItineraire() || onClickLocation($event)"
    (click) = "!getPointImportant() || modal(enregistrerPoint)"
    >


</div>

<button class = "contactUs" (click) = "modal(ContactUs)">Contact us!</button>
<button class = "mapOptionsSetPoint" (click) = "setPointImportant()" [ngbTooltip] = "tooltipSetPoint"><i class="fas fa-map-marker-alt"></i></button>
<button class = "mapOptionsGererPoint" (click) = "redirectionGererPoint()" [ngbTooltip] = "tooltipGererPointImportant"><i class="fas fa-map-marked-alt"></i></button>
<button class = "mapOptionsSearch" (click) = "setItineraire()" [ngbTooltip] = "tooltipSearch"><i class="fas fa-directions"></i></button>
<button class = "mapRechercherTrajet" (click) = "modal(rechercherTrajet)" [ngbTooltip] = "tooltipRechercherTrajet"><i class="fas fa-search-location"></i></button>
<button class = "mapEnregistrerTrajet" (click) = "modal(enregistrerTrajet)" [ngbTooltip] = "tooltipTrajet"><i class="fas fa-sign"></i></button>
<button class = "mapGestionTrajet" (click)= "redirectionGestionTrajet()" [ngbTooltip] = "tooltipGestionTrajet"><i class="fas fa-map-signs"></i></button>
<button class = "mapGestionProfil" (click) = "modal(gestionProfil)" [ngbTooltip] = "tooltipGestionProfil"><i class="fas fa-diagnoses"></i></button>
<button class = "mapOptionsProfil" (click)= "redirectionProfil()" [ngbTooltip] = "tooltipProfil"><i class="fas fa-user"></i></button>



<ng-template #ContactUs let-modal>
    <div class="modal-header">
        <h4 id="modal-basic-title">Contact Us</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body">
        <p>Hésitez pas à nous faire des retours !!!</p>

        <form class="form" (submit) = "contactUs($event)">
            <input required type="email" name="email" id="email_user_contactUs" placeholder="Votre email" pattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$">
            <input required type="textarea" name="message" id="message_user_contactUs" placeholder="Votre message">
            <input type="submit" value="Envoyer">
        </form>
        <p class="error">{{message}}</p>
    </div>
    
</ng-template>

<ng-template #enregistrerPoint let-modal>
    <div class="modal-header">
        <h4 id="modal-basic-title">Enregistrer point</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body">
        <p>Cet endroit sera enregistré, écrivez un message pour l'ajouter au point</p>

        <form class="form" (submit) = "enregistrerPointImportant($event)">
            <input required type="email" name="email" id="email_user_point_important" placeholder="Votre email" pattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$">
            <input required type="textarea" name="message" id="message_user_point_important" placeholder="Libellé du point">
            <input type="submit" value="Envoyer">
        </form>
        <p class="error">{{message}}</p>
    </div>
    
</ng-template>

<ng-template #rechercherTrajet let-modal>
    
    <div class="modal-header">
        <h4 id="modal-basic-title">Rechercher un trajet</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body">

        <form class="form">
            <input required type="text" name="adresse_depart" id="adresse_depart" placeholder="Adresse de départ" title="Minimum 3 lettres, sans espace" pattern="^[a-zA-Z0-9]{3,}$">
            <input required type="text" name="adresse_arrive" id="adresse_arrive" placeholder="Adresse d'arrivée" title="Minimum 3 lettres, sans espace" pattern="^[a-zA-Z0-9]{3,}$">
            <input class="dateTime" required type="time" name="heure_trajet" id="heure_trajet" title="Entrer l'heure du trajet"> <br>
            <input class="dateTime" required type="date" name="date_trajet" id="date_trajet" title="Entrer la date du trajet"> <br>

            <input type="submit" value="Valider"> 
        </form>

    </div>

    <div class="modal-footer">

        <p style="right: 10%;position: relative;">La liste des trajets trouvées s'affichera en bas</p>

        <p class="error">
            {{message}}
        </p>

    </div>

</ng-template>

<ng-template #enregistrerTrajet let-modal>

    <div class="modal-header">
        <h4 id="modal-basic-title">Enregistrer un trajet</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body">

        <form class="form" (submit) = "registerTrajet($event)">
            <input required type="text" name="adresse_depart" id="adresse_depart" placeholder="Adresse de départ" title="Minimum 3 lettres, sans espace" pattern="^[a-zA-Z0-9]{3,}$">
            <input required type="text" name="adresse_arrive" id="adresse_arrive" placeholder="Adresse d'arrivée" title="Minimum 3 lettres, sans espace" pattern="^[a-zA-Z0-9]{3,}$">
            <input class="dateTime" required type="time" name="heure_trajet" id="heure_trajet" title="Entrer l'heure du trajet"> <br>
            <input class="dateTime" required type="date" name="date_trajet" id="date_trajet" title="Entrer la date du trajet"> <br>
            <select required name="options" id="options">
                <option value="" disabled selected>Pouvez-vous faire une/plusieurs escale?</option>
                <option value="oui">Oui</option>
                <option value="non">Non</option>
            </select>
            <input type="text" name="escale" id="escale" placeholder="Si oui, où?" [ngbTooltip] = "tooltipTrajetEscale">
            <input type="submit" value="Valider"> 
        </form>

    </div>

    <div class="modal-footer">

        <p class="error">
            {{message}}
        </p>

        <p>
            Enregistrez soigneusement votre trajet, ces données seront utilisées par les autres voyageurs pour la recherche de covoiturage
        </p>

    </div>

</ng-template>

<ng-template #gestionProfil let-modal>

    <div class="modal-header">
        <h4 id="modal-basic-title">Gestion de votre profil</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body">
        <form (submit) = "updateProfil($event)"> 
            <div class="form-group">
                <input required type="text" name="nom" id="nom_user" value="{{usersData.nom}}" pattern="^[a-zA-Z]{3,}$" title="minimum 3 lettres sans espace et sans chiffres">
                <input required type="text" name="prenom" id="prenom_user" value="{{usersData.prenom}}" pattern="^[a-zA-Z]{3,}$" title="minimum 3 lettres sans espace et sans chiffres">
                <input required type="email" name="email" id="email_user" value="{{usersData.email}}" pattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$">
                <input required type="tel" name="numero" id="numero_user" value="{{usersData.numero}}" pattern="^[0-9]{8,}$" title="minimum 8 chiffres">
                <select required name="type" id="type_user">
                    <option value="" disabled selected>User actuel est {{usersData.typeUser}}</option>
                    <option value="chauffeur">Chauffeur</option>
                    <option value="piéton">Piéton</option>
                </select>
                <input type="submit" value="Valider" class="valider">    
            </div>
        </form>
    </div>
    
    <div class="modal-footer">
        <p class="message">
            {{message}}
        </p>
        <p>
            Cette fenêtre vous permet de voir vos données actuelles et de les modifier si besoin. <br> 
            Pour modifier votre mot de passe, rendez-vous à la fenêtre d'authentification. <br> 
            Pour supprimer votre compte, contactez-nous!
        </p>
    </div>
</ng-template>

<ng-template #tooltipSetPoint>
    Enregistrer point important <b>Attention!</b> Tous points que vous allez clicker sur la map ouvrira un formulaire! Rappuyer pour désactiver
</ng-template>

<ng-template #tooltipGererPointImportant>
    Gestion de vos points importants
</ng-template>

<ng-template #tooltipSearch>
    Trouver une adresse <br><b>Cliquez</b> ouvrira la recherche d'itinéraire <br><b>Recliquez</b> pour la refaire disparaître
</ng-template>

<ng-template #tooltipRechercherTrajet>
    Rechercher un trajet
</ng-template>

<ng-template #tooltipProfil> 
    Gestion des profils
</ng-template>

<ng-template #tooltipGestionProfil>
    Gestion de votre profil
</ng-template>

<ng-template #tooltipTrajet>
    Enregistrer un trajet
</ng-template>

<ng-template #tooltipTrajetEscale>
    Séparer vos adresses par des virgules
</ng-template>

<ng-template #tooltipGestionTrajet>
    Gestion de vos trajets
</ng-template>




